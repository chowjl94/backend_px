const express = require('express')
const swaggerUi = require('swagger-ui-express')
const swaggerJsdoc = require('swagger-jsdoc')
const YAML = require('yamljs');
const swaggerDocument = YAML.load('./src/openapi.yml');

module.exports = (authMiddleware, authService,ampqservice, db) => {
  const router = express.Router()

  router.get('/', (req, res, next) => {
    res.send('Hello world!')

  })
  

  //import auth with DI and pass authService
  router.use('/', require('./auth')(authService))
  const options = {
    definition:{
      openapi:'3.0.0',
      info:{
        title: "Todo list apis",
        version: "1.0.0"
      },
    },
    apis:['./src/routes/*.js'],
  }

  const swaggerSpec = swaggerJsdoc(options)//generates specification 
  router.use('/api-docs',swaggerUi.serve,swaggerUi.setup(swaggerSpec))//swagger ui to serve the specifications

  router.use(authMiddleware)
  router.use('/todo', require('./todo')(db,ampqservice))
  router.use('/indivtask', require('./indivtask')(db))
  

  return router
}
